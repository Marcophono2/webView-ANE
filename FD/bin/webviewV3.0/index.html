<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Ali Tavakoli">
	<script type="text/javascript" src="Bridge.js"></script>
<title>Rich WebView ANE</title>

<style>
/*
	Android does not support fullscreen videos in HTML so, with the following css we are
	removing the fullscreen button from Android
*/

video::-webkit-media-controls-fullscreen-button {
    display: none;
}
video::-webkit-media-controls-play-button {
   background: red; 
}
video::-webkit-media-controls-play-button {}
video::-webkit-media-controls-timeline {}
video::-webkit-media-controls-current-time-display{}
video::-webkit-media-controls-time-remaining-display {}
video::-webkit-media-controls-time-remaining-display {}
video::-webkit-media-controls-mute-button {}
video::-webkit-media-controls-toggle-closed-captions-button {}
video::-webkit-media-controls-volume-slider {}

.hiddenFileInput {
    width: 0;
    height: 0;
    visibility: hidden;
    position: absolute;
    top: 0;
    left: 0;
}

img {
    max-width: 100%;
    max-height: 60%;
    margin-bottom: 8px;
}
</style>

<script>
"use strict";

function diplayAlert(msg)
{
	alert(msg);
}

function onClick($msg)
{
	Bridge.call($msg);
}

function toPlaySound()
{
	// this string will be send to flash. you can send anything from here and then you can parse it on flash side and do whatever you like with it.
	Bridge.call("toPlaySound|");
}

function toOpenJSAlert()
{
	Bridge.call("toOpenJSAlert|");
}

// -----------------------------------------------------------------------------
// https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition
var gpsOptions = {
  enableHighAccuracy: false,
  timeout: 5000,
  maximumAge: 0
};

function onGpsSuccess(pos) {
  var crd = pos.coords;

  alert('Your current position is:\nLatitude : ' + crd.latitude + '\nLongitude: ' + crd.longitude + '\naccuracy: ' + crd.accuracy + 'meters');
};

function onGpsError(err) {
  alert('ERROR(' + err.code + '): \n' + err.message);
};

function getUserLocation()
{
	navigator.geolocation.getCurrentPosition(onGpsSuccess, onGpsError, gpsOptions);
}

// -----------------------------------------------------------------------------
// demo code for choosing a file
window.onload = function() {
    console.log('window.onload');
    var loadFileBtn = document.querySelector('.loadFileBtn');
    var fileInputField = document.querySelector('.hiddenFileInput');
    var img = document.querySelector('img');
	//var debug = document.querySelector('#debug');

    loadFileBtn.addEventListener('click', function() 
	{
        fileInputField.click();
    }.bind(this));
	
    fileInputField.addEventListener('change', function(evt) 
	{
		//debug.value = "1_";
		var theFile = evt.target.files[0];
		var _size = theFile.size;
		//if(_size > 256000)
		//{
			//alert("please pick a file smaller than 250KB!\nYou are not limited to this size of course!\nThis is just a demo.");
			//return;
		//}
		
		if (typeof FileReader === "undefined") 
		{
			alert("Your browser is too old!\nUse another method to deal with the selected file.");
			return;
		}
		
		// https://developer.mozilla.org/en-US/docs/Web/API/FileReader
        var reader = new FileReader();
		
		
		reader.onloadend = function (evt) 
		{
			img.src = evt.target.result;
			
			if(evt.target.error)
			{
				// https://developer.mozilla.org/en-US/docs/Web/API/FileError
				alert("error code = " + evt.target.error.code + "\nsee what this err code means:\nhttps://developer.mozilla.org/en-US/docs/Web/API/FileError");
			}
        };
		
		
		if(theFile)
		{
			reader.readAsDataURL(theFile);
		}
        else
		{
			alert("error = file not found");
		}
    });
};

// -----------------------------------------------------------------------------

</script>

<!-- to support older Android versions for picking a file -->
<script src="bower_components/modernizr/modernizr.custom.72986.js"></script>
</head>

<body>
	<h2>Rich WebView ANE V3.0 (iOS+Android)</h2>
	
	<p>
	<button type="button" onClick="onClick('closeWebView|')">closeWebView</button>
	</p>
	
	<p>The WebView extension lets you create a web view port inside your AdobeAir mobile application and load content from a URL or an offline html file
	on Android and iOS. This is basically what the Adobe's default StageWebView does but the power point this extension has, is the ability to enable your
	JavaScript code communicate with your flash logic! we are using the latest features that Android and iOS SDK provide to let you get the best out of the
	webView on both platforms.</p>
	
	<p>
	<h4>Main Features:</h4>
	<ul>
		<li>Call JS funcs from flash</li>
		<li>And send messages to flash from JS</li>
		<li>Navigate back and forth through pages</li>
		<li>Control the Scroll position</li>
		<li>Change the view port size and position at runtime</li>
		<li>Play video files inside the webview</li>
		<li>Take full screenshots from your webview object</li>
		<li>get GPS location information in to your JS</li>
		<li>enable file picker dialog on your HTML input fields</li>
		<li>And of course you can do whatever HTML allowes you to do!</li>
	</ul>
	
	let's see these features in more details!
	</p>
	
	<p>
	<h4>Communicate between Flash and JS</h4>
	Well, possebilities are endless when you can send messages to flash and vice versa. you may do simple tasks like playing a sound or showing a toast but you
	can also do complicated stuff like opening the camera, taking a picture and retrive the photo in your JS logic! I don't know, just use your imagination! As
	a very simple test, I'm going to tell my flash app to play a sound by calling the following func from my html: <font color="#FF9900">toPlaySound()</font> 
	<a href="javascript:void(0);" onclick="toPlaySound();" return false;>CLICK ME!</a> <b>make sure your device is not silenced to hear the sound</b>
	<br><br>
	as another test, I'm going to send a message to flash and in return, flash will call JS to open an Alert window! <a href="javascript:void(0);" onclick="toOpenJSAlert();" return false;>
	CLICK HERE.</a>
	</p>
	
	<p>
	<h4>Resizing the view port in runtime</h4>
	Being able to resize and position your webView is very important because with that you will be able to put the web view anywhere inside your app design
	in case you don't want to open it in fullscreen like this sample! you can easily change the position and dimension of your view from flash... try the
	following buttons to test the resizing option...
	<button type="button" onClick="onClick('changePosition|50|100|100|200')">changePosition</button>
	<button type="button" onClick="onClick('changePosition|0|0|0|0')">fullscreen</button>
	</p>
	
	<p>
	<h4>Control the scroll position</h4>
	html and JS is able to control the scrolling of a web page but you will have more options if you use the ANE methods like:
	<ul>
		<li>_ex.pageDown(false);</li>
		<li>_ex.pageDown(true);</li>
		<li><a href="javascript:void(0);" onclick="onClick('pageUp|')" return false;>_ex.pageUp(false);</a></li>
		<li><a href="javascript:void(0);" onclick="onClick('firstPage|')" return false;>_ex.pageUp(true);</a></li>
		<li><a href="javascript:void(0);" onclick="onClick('zoomIn|')" return false;>_ex.zoomIn();</a></li>
		<li><a href="javascript:void(0);" onclick="onClick('zoomOut|')" return false;>_ex.zoomOut();</a></li>
		<li>_ex.filingScroll(0, 200);</li>
		<li>_ex.scrollBy(0, -200);</li>
		<li>_ex.scrollTo(_ex.scrollX, (_ex.scrollY + 200));</li>
	</ul>
	</p>
	
	<p>
	<h4>Take Bitmap screenshots</h4>
	if you need screenshots to be taken from your webview page, all you have to do is to call _ex.requestBitmap();
	<button type="button" onClick="onClick('toTakeScreenshot|')">test the screenshot!</button>
	</p>

	<!--uncomment the video tag to see how it works but becareful with it because older Android devices do not support HTML5 video fully-->
	<!--<p>
	<h4>Play video clips inline</h4>
	<video width="300" controls poster="image.jpg">
	<source src="movie01.mp4" type="video/mp4">
	  Your browser does not support HTML5 video.
	</video>
	</p>-->
	
	<p>
	<h4>get Gps information from browser</h4>
	You can use JS libraries to get GPS information. as a test, touch this button and wait a few seconds for an alert window reporting your location.
	<button type="button" onClick="onClick(getUserLocation())">test GPS!</button>
	</p>
	
	<p>
	<h4>File Picker</h4>
	You can also use an ordinary html inputfield to let users pick a file from their device! use the following button to test it.
	
	<input type="file" accept="image/*" class="hiddenFileInput">
    <button class="loadFileBtn">Load File</button>
	<!--<input id="debug" type="text"/>-->
	<img src="" />
	
	</p>
	
	
</body>
</html>